# Simple multi-arch Dockerfile for testing
FROM alpine:3.19

# Install curl for healthchecks and testing
RUN apk add --no-cache curl ca-certificates

# Create app directory
WORKDIR /app

# Create a simple test file
RUN echo "Build successful!" > /app/build-info.txt && \
    echo "Timestamp: $(date)" >> /app/build-info.txt && \
    echo "Architecture: $(uname -m)" >> /app/build-info.txt

# Add a simple script
RUN echo '#!/bin/sh' > /app/start.sh && \
    echo 'echo "Container started successfully!"' >> /app/start.sh && \
    echo 'cat /app/build-info.txt' >> /app/start.sh && \
    echo 'echo "Keeping container alive..."' >> /app/start.sh && \
    echo 'tail -f /dev/null' >> /app/start.sh && \
    chmod +x /app/start.sh

# Healthcheck
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD cat /app/build-info.txt || exit 1

# Expose a port (optional)
EXPOSE 8080

# Run the script
CMD ["/app/start.sh"]
